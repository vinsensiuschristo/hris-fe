<header class="app-header">
  <div class="header-left">
    <!-- Desktop: Collapse Sidebar Button -->
    <button 
      class="toggle-btn desktop-only"
      (click)="onToggleSidebar()"
    >
      <i class="pi" [ngClass]="isSidebarCollapsed ? 'pi-bars' : 'pi-times'"></i>
    </button>
    
    <!-- Mobile: Hamburger Menu -->
    <button 
      class="toggle-btn mobile-only"
      (click)="onToggleMobileMenu()"
    >
      <i class="pi pi-bars"></i>
    </button>
  </div>
  
  <div class="header-right">
    <!-- Notifications - for all users -->
    <button class="header-icon-btn" (click)="notifOp.toggle($event)">
      <i class="pi pi-bell"></i>
      @if (unreadCount > 0) {
        <span class="notification-badge">{{ unreadCount }}</span>
      }
    </button>
    
    <p-popover #notifOp>
      <ng-template pTemplate="content">
        <div class="notification-dropdown">
          <div class="notif-header">
            <span class="notif-title">Notifikasi</span>
            @if (unreadCount > 0) {
              <button class="mark-read-btn" (click)="markAllAsRead()">Tandai semua dibaca</button>
            }
          </div>
          
          @if (loadingNotifications) {
            <div class="notif-loading">
              <i class="pi pi-spin pi-spinner"></i>
              <span>Memuat...</span>
            </div>
          } @else {
            <div class="notif-list">
              @for (notif of notifications; track notif.id) {
                <div 
                  class="notif-item" 
                  [class.unread]="!notif.isRead"
                  (click)="navigateToNotification(notif)"
                >
                  <div class="notif-icon" [class.leave]="notif.type === 'leave'" [class.overtime]="notif.type === 'overtime'">
                    <i class="pi" [ngClass]="notif.type === 'leave' ? 'pi-calendar' : 'pi-clock'"></i>
                  </div>
                  <div class="notif-content">
                    <span class="notif-item-title">{{ notif.title }}</span>
                    <span class="notif-desc">{{ notif.description }}</span>
                    <span class="notif-time">{{ notif.time }}</span>
                  </div>
                  @if (!notif.isRead) {
                    <span class="unread-dot"></span>
                  }
                </div>
              } @empty {
                <div class="notif-empty">
                  <i class="pi pi-check-circle"></i>
                  <span>Tidak ada notifikasi baru</span>
                </div>
              }
            </div>
          }
          
          <div class="notif-footer">
            @if (isAdminOrHR) {
              <a routerLink="/approvals/leave">Lihat semua persetujuan</a>
            } @else {
              <a routerLink="/leave-requests">Lihat pengajuan saya</a>
            }
          </div>
        </div>
      </ng-template>
    </p-popover>
    
    <!-- User Menu -->
    <div class="user-menu" (click)="op.toggle($event)">
      <div class="user-avatar-circle">{{ userInitials }}</div>
      <div class="user-info desktop-only">
        <span class="user-name">{{ displayName }}</span>
        <span class="user-role">{{ userRole }}</span>
      </div>
      <i class="pi pi-chevron-down desktop-only"></i>
    </div>
    
    <p-popover #op>
      <ng-template pTemplate="content">
        <div class="user-dropdown">
          <div class="dropdown-header">
            <div class="user-avatar-circle large">{{ userInitials }}</div>
            <div class="dropdown-user-info">
              <span class="dropdown-name">{{ displayName }}</span>
              <span class="dropdown-role">{{ userRole }}</span>
            </div>
          </div>
          <hr />
          <ul class="dropdown-menu">
            @for (item of userMenuItems; track $index) {
              @if (item.separator) {
                <li class="separator"></li>
              } @else {
                <li class="menu-item" (click)="item.command && item.command({})">
                  <i [class]="item.icon"></i>
                  <span>{{ item.label }}</span>
                </li>
              }
            }
          </ul>
        </div>
      </ng-template>
    </p-popover>
  </div>
</header>
